@model IEnumerable<skipper_group_new.Models.ProductBrands>

<style>
    .brand-section {
        overflow: hidden;
    }

    .brand-header {
        background-color: #007bff;
        border-bottom: 2px solid #0056b3;
        letter-spacing: 0.5px;
    }

    .brand-header h6 {
        font-size: 1rem;
        color: #fff;
    }

    .brand-models {
        background: #f9f9f9;
        border-top: 1px solid #e1e1e1;
        border-radius: 0 0 0.5rem 0.5rem;
    }

    .model-label {
        background: #fff;
        border: 1px solid #e1e1e1;
        border-radius: 5px;
        padding: 6px 10px;
        transition: all 0.2s ease-in-out;
    }

    .model-label:hover {
        background: #e8f1ff;
        border-color: #007bff;
    }

    .model-checkbox {
        accent-color: #007bff;
        transform: scale(1.1);
    }

    .brand-container {
        margin-top: 15px;
    }
</style>

@if (Model != null && Model.Any())
{
    <div class="brand-container" style="height:480px; overflow-y:auto !important">
        @foreach (var brand in Model)
        {
            <div class="brand-section mb-4 shadow-sm border rounded bg-white">
                <!-- Brand Header -->
                <div class="brand-header text-center text-white bg-primary py-2 rounded-top">
                    <h6 class="mb-0 font-weight-bold">@brand.brandTitle</h6>
                </div>

                <!-- Model List -->
                <div class="brand-models p-3">
                    @if (brand.Model != null && brand.Model.Any())
                    {
                        <div class="row">
                            @foreach (var m in brand.Model)
                            {
                                <div class="col-md-3 col-sm-4 col-6 mb-2">
                                    <label class="d-flex align-items-center model-label">
                                        <input type="checkbox"
                                               name="selectedModels"
                                               value="@($"{brand.brandID}_{m.modelID}")"
                                               class="mr-2 model-checkbox"
                                        @(m.Status ? "checked" : "") />
                                        <span style="color:@(m.Status ? "red" : "black")">
                                            @m.modeTitle
                                        </span>
                                    </label>

                                    <!-- Hidden Fields -->
                                    <input type="hidden" name="BrandId_@m.modelID" value="@m.BrandId" />
                                    <input type="hidden" name="ModelID_@m.modelID" value="@m.modelID" />
                                    <input type="hidden" name="ProjId_@m.modelID" value="@m.ProjId" />
                                    <input type="hidden" name="BlogoId_@m.modelID" value="@m.BlogoId" />
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-muted text-center">No models available.</div>
                    }
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="text-center text-danger">No brand/model data found.</div>
}

<!-- Save / Cancel Buttons -->
<div class="text-center mt-3">
    <button type="button" class="btn btn-success px-4" id="btnSaveProductSize">Save</button>
    <button type="button" class="btn btn-secondary px-4" data-dismiss="modal">Cancel</button>
</div>

<script>
    $("#btnSaveProductSize").on("click", function () {
        const models = [];

        $(".model-checkbox").each(function () {
            const isChecked = $(this).is(":checked");
            const [brandId, modelId] = $(this).val().split("_");

            if (isChecked) {  // ✅ Only send checked models
                models.push({
                    BrandId: parseInt(brandId),
                    modelID: parseInt(modelId),
                    BlogoId: parseInt($(`input[name='BlogoId_${modelId}']`).val()) || 0,
                    ProjId: parseInt($(`input[name='ProjId_${modelId}']`).val()) || 0,
                    modeTitle:"",
                    Status:false,
                });
            }
        });

        $.ajax({
            url: '/Products/UpdateProductSize',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(models),
            success: function (response) {
                if (response.success) {
                    alert("✅ Product sizes updated successfully!");
                    setTimeout(function () {
                        window.location.href = '/backoffice/Products/viewproducttyres';
                    }, 1000);
                } else {
                    alert("⚠️ Failed: " + response.message);
                    setTimeout(function () {
                        window.location.href = '/backoffice/Products/viewproducttyres';
                    }, 1000);
                }
            },
            error: function (err) {
                console.error(err);
                setTimeout(function () {
                    window.location.href = '/backoffice/Products/viewproducttyres';
                }, 2000);
            }
        });
    });
</script>
