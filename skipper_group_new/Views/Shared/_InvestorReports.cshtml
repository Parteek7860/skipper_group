@model IEnumerable<ReportModel>

@if (Model != null && Model.Any())
{
    var first = Model.First();

    <div class="invest_rght">
        <div class="shrt-title">
            <h6>Navigating Growth, <span>Empowering Progress</span></h6>
            <h4>@first.title</h4>
        </div>

        @if (first.shortDetail == null)
        {
            <div class="anul_grid">
                @foreach (var item in Model)
                {
                    <div class="pdf-img">
                        <figure>
                            @if (!string.IsNullOrEmpty(item.uploadaimage))
                            {
                                <img src="/Uploads/ProductsImage/@item.uploadaimage" class="img-fluid w-100" alt="@item.productname" />
                            }
                            <figcaption>
                                <div class="pdf-text">
                                    <p>@item.productname</p>
                                    <p><span>@item.yearcategory</span></p>
                                </div>
                                <img src="/images/icon/pdf-icon.svg" alt="pdf-icon">
                            </figcaption>
                        </figure>
                        <a href="/uploads/prospectus/@item.prospectus" class="links" target="_blank"></a>
                    </div>
                }
            </div>
        }
        else
        {
            @if (first.shortDetail == "")
            {
                <div class="cont-sec">
                    <h3>Investor Query</h3>
                    <div class="contact_one">
                        <div class="contact_rght">
                            <div class="inquiry-form-wrapper">
                                <input type="hidden" id="eid" name="name" value=0 />
                                <div class="input_bx">
                                    <input type="text" id="invName" placeholder="Name">
                                </div>
                                <div class="input_bx">
                                    <input type="text" id="invEmail" placeholder="Email Address">
                                </div>
                                <div class="input_bx">
                                    <input type="text" id="invMobile" maxlength="10" placeholder="Mobile No">
                                </div>
                                <div class="input_bx">
                                    <input type="text" id="invAddress" placeholder="Address">
                                </div>
                                <div class="input_bx">
                                    <textarea id="invComment" rows="2" placeholder="Comment"></textarea>
                                </div>

                                <div class="input_bx">
                                    <figure class="captcha_wrap">
                                        <input type="text" id="invCaptcha" placeholder="Enter captcha code *">
                                    </figure>
                                    <span id="captchaError" style="color:red;font-size:13px;"></span> 
                                </div>


                                <div class="captcha-colm" style="display:flex;align-items:center;gap:10px;padding:8px 12px;">
                                    <span id="captchaText"
                                          style="font-weight:700;font-size:20px;color:#2c3e50;letter-spacing:3px;font-family:monospace;">
                                    </span>
                                    <a href="javascript:;" onclick="RefreshCaptcha()" style="display:flex;align-items:center;justify-content:center;width:28px;height:28px;">
                                        <img src="/images/loader.png" alt="" class="cap-loader" style="width:18px;height:18px;object-fit:contain;">
                                    </a>
                                </div>
                               
                                <div class="submit-btn">
                                    <input type="submit" onclick="SubmitQuery()" class="aos-init aos-animate">
                                </div>
                            </div>
                        </div> 
                    </div> 
                </div> 
            }
            else
            {
                @Html.Raw(first.shortDetail)
            }
        }
    </div> 
}
else
{
    <h4>No Data Available</h4>
}



<script >
    $(document).ready(function () {
        RefreshCaptcha();
    });

    function RefreshCaptcha() {
        $.get("/SkipperInvestor/GetCaptcha", function (res) {
            $("#captchaText").text(res.code);
        });
    }

        function SubmitQuery() {

        let isValid = true;

        // Clear old errors
        $(".input-error").remove();

        // Validate each field
        if ($("#invName").val().trim() == "") {
            $("#invName").after('<span class="input-error" style="color:red;font-size:12px;">Name is required</span>');
            isValid = false;
        }
        if ($("#invEmail").val().trim() == "") {
            $("#invEmail").after('<span class="input-error" style="color:red;font-size:12px;">Email is required</span>');
            isValid = false;
        }
        if ($("#invMobile").val().trim() == "") {
            $("#invMobile").after('<span class="input-error" style="color:red;font-size:12px;">Mobile No. is required</span>');
            isValid = false;
        }
        if ($("#invAddress").val().trim() == "") {
            $("#invAddress").after('<span class="input-error" style="color:red;font-size:12px;">Address is required</span>');
            isValid = false;
        }
        if ($("#invComment").val().trim() == "") {
            $("#invComment").after('<span class="input-error" style="color:red;font-size:12px;">Comment is required</span>');
            isValid = false;
        }
        if ($("#invCaptcha").val().trim() == "") {
            $("#invCaptcha").after('<span class="input-error" style="color:red;font-size:12px;">Captcha is required</span>');
            isValid = false;
        }

        if (!isValid) return;

        let data = {
            Id: $("#eid").val(),
            Name: $("#invName").val(),
            Email: $("#invEmail").val(),
            Mobile: $("#invMobile").val(),
            Address: $("#invAddress").val(),
            Comment: $("#invComment").val(),
            CaptchaCode: $("#invCaptcha").val()
        };

        $.ajax({
            url: '/SkipperInvestor/SaveInvestorQuery',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (res) {
                $("#captchaError").text("");

                if (res.status) {
                    alert(res.message);
                    $("input,textarea").val("");
                    RefreshCaptcha();
                } else {
                    if (res.message.includes("Captcha")) {
                        $("#captchaError").text(res.message);
                    } else {
                        alert(res.message);
                    }
                    RefreshCaptcha();
                }
            }
        });
    }

</script>

