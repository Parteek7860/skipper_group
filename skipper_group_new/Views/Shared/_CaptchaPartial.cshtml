@model string

<div id="captchaBox" style="display:flex; align-items:center; gap:10px;">
    <span id="captchaText" class="form-control text-center"
          style="width:120px; background:#f3f3f3; font-weight:bold;">
        @Model
    </span>
    <button type="button" class="btn btn-outline-secondary" title="Refresh Captcha"
            onclick="refreshCaptcha(event)">
        ↻
    </button>
</div>
@{
    string nonce = Context.Items["CSPNonce"]?.ToString();
}
<script nounce="@nonce">
    async function refreshCaptcha(e) {
        if (e) e.preventDefault(); 
        const btn = e?.target;
        btn.disabled = true;
        btn.innerText = "⟳"; 

        try {
            const response = await fetch('/MetroHome/RefreshCaptcha', {
                method: 'POST',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            });

            if (response.ok) {
                const html = await response.text();
                const container = document.getElementById('captchaContainer');
                if (container) {
                    container.innerHTML = html;
                } else {
                    console.error("captchaContainer not found in DOM");
                }
            } else {
                console.error("Failed to refresh captcha:", response.status);
            }
        } catch (err) {
            console.error("Error refreshing captcha:", err);
        } finally {
            btn.disabled = false;
            btn.innerText = "↻";
        }
    }
</script>
